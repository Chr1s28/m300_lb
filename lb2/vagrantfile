Vagrant.configure("2") do |config|
  config.vm.define "apiServer" do |api|
    api.vm.hostname = "Apiserver"
    api.vm.box = "generic/debian10"
    api.vm.provision "file", source: "api/main.py", destination: "main.py"
    api.vm.provision "shell", path: "api.sh"
    api.vm.network "private_network", ip: "192.168.2.30"
    api.vm.network "forwarded_port", guest: 80, host: 9999, id: "Api", auto_correct: true

  end

  config.vm.define "nginx" do |nginx|
    nginx.vm.hostname = "nginx"
    nginx.vm.box = "ubuntu/xenial64"
    #Startup shell script
    nginx.vm.provision "file", source: "server_configuration", destination: "server_configuration"
    nginx.vm.provision "shell", path: "ngnix.sh"
    #Creating Portforwarding for reverse proxy
    nginx.vm.network "forwarded_port", guest: 80, host: 8080, id: "nginx"
    nginx.vm.network "private_network", ip: "192.168.2.10"
  end

  config.vm.define "Webserver" do |apache|
    apache.vm.hostname = "Webserver"
    apache.vm.box = "ubuntu/xenial64"

    apache.vm.provision "shell", path: "webserver1.sh"
    apache.vm.network "private_network", ip: "192.168.2.20"
    apache.vm.network "forwarded_port", guest: 80, host: 8008, id: "webserver1", auto_correct: true
    apache.vm.synced_folder "/webserver", "/var/www/html"
      
  end


end